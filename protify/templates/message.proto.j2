{% import "render_macros.j2" as macros %}

message {{+ short_name +}} {
{% if let Some(names) = render_reserved_names() ~%}
  {{+ names ~}}
{%~ endif %}

{%~ if let Some(numbers) = render_reserved_numbers() ~%}
  {{+ numbers ~}}
{%~ endif %}

  {% let all_options = options_with_validators() %}
  {%~ for option in all_options.iter() +%}
  option {{+ option.name +}} = {{+ option.value | indent(2) }};
  {% endfor +%}
  {% call macros::empty_line_if(!all_options.is_empty()) %}{% endcall %}

{% for enum_ in enums %}
{%+ filter indent(2) ~%}
{{+ enum_.render()? +}}
{%~ endfilter %}
{%~ endfor %}

{% for nested_msg in messages %}
{%+ filter indent(2) ~%}
{{+ nested_msg.render()? +}}
{%+ endfilter %}
{% endfor %}

{% for entry in entries %}
{% match entry %}
  {%~ when MessageEntry::Oneof(oneof) +%}
  oneof {{+ oneof.name +}} {
    {% let all_options = oneof.options_with_validators() %}
    {% filter indent(4) %}
    {% for option in all_options.iter() ~%}
    option {{+ option.name +}} = {{+ option.value }};
    {% endfor %}
    {% endfilter ~%}
    {% call macros::empty_line_if(!all_options.is_empty()) %}{% endcall %}
    {%~ for field in oneof.fields ~%}
    {%+ call macros::render_field(field, package, 4) %}{% endcall %}
    {% endfor +%}
  }
  {% when MessageEntry::Field(field) ~%}
  {%+ call macros::render_field(field, package, 2) %}{% endcall %}
{% endmatch %}
{% endfor +%}
}
